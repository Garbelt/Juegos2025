<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Menú del Docente - AfinCon</title>
<style>

/* ===== BASE MOBILE ===== */

body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #f4f6f9;
}

.container {
    width: 100%;
    max-width: 500px;
    margin: 0 auto;
    padding: 20px;
    box-sizing: border-box;
    display: none; /* importante: sigue oculto hasta verificar acceso */
}

.header {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 20px;
}

.header h2 {
    margin: 0;
    font-size: 20px;
}

#menuButtons {
    list-style: none;
    padding: 0;
    margin: 0;
}

.themeButton {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    border: none;
    border-radius: 10px;
    margin-bottom: 12px;
    background-color: #2980b9;
    color: #fff;
    cursor: pointer;
    transition: transform 0.1s ease;
}

.themeButton:active {
    transform: scale(0.98);
}

.buttonContainer {
    margin-top: 30px;
}

#backtoareaButton {
    width: 100%;
    padding: 12px;
    font-size: 15px;
    border: none;
    border-radius: 10px;
    background-color: #ddd;
    cursor: pointer;
}

.message.inhabilitado {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #ffcc00;
    color: #000;
    padding: 20px;
    border: 2px solid #333;
    border-radius: 10px;
    font-size: 18px;
    text-align: center;
    width: 85%;
    max-width: 320px;
    display: none;
    z-index: 9999;
}

/* ===== FORMATO ESCRITORIO ===== */

@media (min-width: 1024px) {

    body {
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .container {
        width: 700px;
        min-height: 400px;
        max-height: 80vh;
        border: 1px solid #ccc;
        border-radius: 5px;
        display: flex;
        flex-direction: column;
    }

    #menuButtons {
        flex: 1;
        overflow-y: auto;
    }

    #backtoareaButton {
        width: 50%;
    }

    .buttonContainer {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    .message.inhabilitado {
        width: 90%;
        border: 3px solid #000;
    }

}

</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h2>ESPACIO DEL DOCENTE</h2>
    </div>
    <ul id="menuButtons"></ul>
    <div class="buttonContainer">
        <button id="backtoareaButton" onclick="volverAlIndice()">VOLVER</button>
    </div>
</div>

<div id="message" class="message inhabilitado"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-database-compat.js"></script>

<script>
// ===== Configuración de Firebase =====
const firebaseConfig = {
    apiKey: "AIzaSyBVZaysx9d6u6P13DYINPtcinpf79Sgx4U",
    authDomain: "juego001-469b6.firebaseapp.com",
    databaseURL: "https://juego001-469b6-default-rtdb.firebaseio.com",
    projectId: "juego001-469b6",
    storageBucket: "juego001-469b6.appspot.com",
    messagingSenderId: "528847999661",
    appId: "1:528847999661:web:6085a104fe64262a042c24"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();

// ===== Variables para mensajes =====
let mensajePendiente = null;
let mensajeSecundario = null;
let audioPrimero = null;
let audioSegundo = null;

// ===== Datos de los temas =====
const menuData = [
  { title: "EDITAR PERMISOS Y HABILITAR ALUMNOS PARA JUGAR", key: "Edit_PermyHabil", url: "Edit_PermyHabil.html" },
  { title: "CONSULTAR LA ACTIVIDAD DE TUS ALUMNOS", key: "srad", url: "srad.html" },
  { title: "IR AL ESPACIO DE JUEGOS", key: "juegos", url: "../Menu/juegos.html" },
  { title: "CONTACTAR AL ADMINISTRADOR", key: "mailaadmin", url: "mailaadmin.html" },
];

// ===== Inicialización de entrarA y entrarB =====
if (!localStorage.getItem("entrarA")) {
    localStorage.setItem("entrarA", Math.floor(1000 + Math.random() * 9000));
}
if (!localStorage.getItem("entrarB")) {
    localStorage.setItem("entrarB", "NO");
}

let entrarA = localStorage.getItem("entrarA");
let entrarB = localStorage.getItem("entrarB");
const uid = localStorage.getItem("uid"); // uid guardado en login

// ===== Función de verificación de acceso =====
function verificarAcceso() {
    if (!uid) {
        accesoDenegado("ACCESO DENEGADO.");
        return;
    }

    database.ref("usuarios/" + uid + "/rol").get().then(snapshot => {
        const rol = snapshot.val();
        if (entrarA === entrarB && rol === "docente") {
            // Acceso permitido
            document.querySelector(".container").style.display = "flex"; // <-- mostrar
            localStorage.setItem("entrarB", "NO"); // desigualado
            generateMenu("menuButtons");
        } else {
            accesoDenegado("ACCESO DENEGADO.");
        }
    }).catch(err => {
        console.error("Error al leer rol:", err);
        accesoDenegado("ERROR DE CONEXIÓN.");
    });
}

// ===== Función para generar menú =====
function generateMenu(containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = "";
    menuData.forEach(item => {
        const li = document.createElement("li");
        const btn = document.createElement("button");
        btn.classList.add("themeButton");
        btn.textContent = item.title;
        btn.addEventListener("click", () => {
            localStorage.setItem("submenu", "juegos");

            // 🔹 Sincronización segura antes de navegar
            const nuevoValor = Math.floor(1000 + Math.random() * 9000);
            localStorage.setItem("entrarA", nuevoValor);
            localStorage.setItem("entrarB", nuevoValor);

            window.location.href = item.url;
        });
        li.appendChild(btn);
        container.appendChild(li);
    });
}

// ===== Función para volver al índice =====
function volverAlIndice() {
    const nuevoValor = Math.floor(1000 + Math.random() * 9000);
    localStorage.setItem("entrarA", nuevoValor);
    localStorage.setItem("entrarB", nuevoValor);
    window.location.href = "../index.html";
}

// ===== Funciones de mensajes =====
function accesoDenegado(msg) {
    document.getElementById("menuButtons").style.display = "none";
    document.getElementById("backtoareaButton").style.display = "none";
    setMensajesPendientes(msg, "SE TE REDIRIGIRÁ AL INICIO.", "sound/fx/denegado.mp3", "sound/fx/redireccionando.mp3");
}

function setMensajesPendientes(msg1, msg2, aud1, aud2) {
    mensajePendiente = msg1;
    mensajeSecundario = msg2;
    audioPrimero = aud1;
    audioSegundo = aud2;
}

function mostrarMensajesSecuenciales(msg1, msg2, audio1, audio2) {
    const messageEl = document.getElementById("message");
    messageEl.textContent = msg1;
    messageEl.style.display = "block";

    const a1 = new Audio(audio1);
    a1.play().catch(e => console.warn("Error primer audio:", e));

    a1.onended = () => {
        messageEl.textContent = msg2;
        const a2 = new Audio(audio2);
        a2.play().catch(e => console.warn("Error segundo audio:", e));

        a2.onended = () => {
            window.location.href = "../index.html";
        };
    };
}

// ===== Primer clic para disparar mensajes =====
window.addEventListener("click", () => {
    if (mensajePendiente && mensajeSecundario) {
        mostrarMensajesSecuenciales(mensajePendiente, mensajeSecundario, audioPrimero, audioSegundo);
        mensajePendiente = null;
        mensajeSecundario = null;
    }
});

// ===== Ejecutar verificación al cargar =====
verificarAcceso();
</script>
</body>
</html>
