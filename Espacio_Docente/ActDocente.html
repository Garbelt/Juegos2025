<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Espacio del Docente - AFINANDO CONOCIMIENTOS</title>

<link rel="stylesheet" href="../Menu/estilosmenu.css?v=1" />
</head>
<body>

<div class="container">
    <div class="headerCenter">
        <h2>ESPACIO DEL DOCENTE</h2>
    </div>

    <ul id="menuButtons"></ul>

    <div class="buttonContainer">
        <button id="backtoareaButton" onclick="volverAlIndice()">VOLVER</button>
    </div>
</div>

<div id="message" class="message inhabilitado"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-database-compat.js"></script>

<script>
// ===== ConfiguraciÃ³n de Firebase =====
const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "TU_AUTH_DOMAIN",
    databaseURL: "TU_DATABASE_URL",
    projectId: "TU_PROJECT_ID",
    storageBucket: "TU_STORAGE_BUCKET",
    messagingSenderId: "TU_MESSAGING_ID",
    appId: "TU_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();

// ===== Variables =====
let mensajePendiente = null;
let mensajeSecundario = null;
let audioPrimero = null;
let audioSegundo = null;

// ===== Datos del menÃº =====
const menuData = [
  { title: "EDITAR PERMISOS Y HABILITAR ALUMNOS PARA JUGAR", url: "Edit_PermyHabil.html" },
  { title: "CONSULTAR LA ACTIVIDAD DE TUS ALUMNOS", url: "srad.html" },
  { title: "IR AL ESPACIO DE JUEGOS", url: "../Menu/juegos.html" },
  { title: "CONTACTAR AL ADMINISTRADOR", url: "mailaadmin.html" },
];

// ===== InicializaciÃ³n seguridad =====
if (!localStorage.getItem("entrarA")) {
    localStorage.setItem("entrarA", Math.floor(1000 + Math.random() * 9000));
}
if (!localStorage.getItem("entrarB")) {
    localStorage.setItem("entrarB", "NO");
}

let entrarA = localStorage.getItem("entrarA");
let entrarB = localStorage.getItem("entrarB");
const uid = localStorage.getItem("uid");

// ===== VerificaciÃ³n acceso =====
function verificarAcceso() {

    if (!uid) {
        accesoDenegado("ACCESO DENEGADO.");
        return;
    }

    database.ref("usuarios/" + uid + "/rol").get().then(snapshot => {
        const rol = snapshot.val();

        if (entrarA === entrarB && rol === "docente") {

            document.querySelector(".container").style.display = "block"; // ðŸ”¥ CORRECTO
            localStorage.setItem("entrarB", "NO");
            generateMenu();

        } else {
            accesoDenegado("ACCESO DENEGADO.");
        }

    }).catch(() => {
        accesoDenegado("ERROR DE CONEXIÃ“N.");
    });
}

// ===== Generar menÃº =====
function generateMenu() {
    const container = document.getElementById("menuButtons");
    container.innerHTML = "";

    menuData.forEach(item => {
        const li = document.createElement("li");
        const btn = document.createElement("button");

        btn.classList.add("themeButton");
        btn.textContent = item.title;

        btn.addEventListener("click", () => {

            const nuevoValor = Math.floor(1000 + Math.random() * 9000);
            localStorage.setItem("entrarA", nuevoValor);
            localStorage.setItem("entrarB", nuevoValor);

            window.location.href = item.url;
        });

        li.appendChild(btn);
        container.appendChild(li);
    });
}

// ===== Volver =====
function volverAlIndice() {
    const nuevoValor = Math.floor(1000 + Math.random() * 9000);
    localStorage.setItem("entrarA", nuevoValor);
    localStorage.setItem("entrarB", nuevoValor);
    window.location.href = "../index.html";
}

// ===== Denegado =====
function accesoDenegado(msg) {
    document.getElementById("menuButtons").style.display = "none";
    document.getElementById("backtoareaButton").style.display = "none";
    document.querySelector(".container").style.display = "block";

    const messageEl = document.getElementById("message");
    messageEl.textContent = msg;
    messageEl.style.display = "block";
}

// ===== Ejecutar =====
verificarAcceso();

</script>
</body>
</html>
